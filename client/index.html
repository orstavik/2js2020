<link rel='stylesheet' href='test.css'>
<script src='test.js'></script>

<script src="wc/aPopupGroup.js"></script>
<script>customElements.define('a-popup', aPopup);</script>

<h1>hello sunshine worker</h1>
<div id="userData">
  <style>
    #login {
      display: block;
    }
    #logout {
      display: none;
    }
    #userData {
      border: 2px solid orangered;
    }
    #userData[active] > #login {
      display: none;
    }
    #userData[active] > #logout {
      display: block;
    }
  </style>
  <div id="login">
    <h3>login</h3>
    RememberMe: <input type='checkbox'/><br>
    <a-popup href="https://auth.2js.no/login/google" group="login">login google</a-popup><br>
    <a-popup href="https://auth.2js.no/login/github" group="login">login github</a-popup><br>
  </div>
  <div id="logout">
    <pre></pre>
    <a-popup href="https://auth.2js.no/logout">logout</a-popup><br><!--todo should logout occur in the main window?-->
    <a-popup href="https://db.2js.no/SESSION">see the data stored in a cookie on my computer</a-popup>
  </div>
</div>

<script>

  window.addEventListener('message', function (e) {
    if (e.origin !== 'https://auth.2js.no'/* || e.source !== loginWindow*/) //todo do we need to check e.source?
      return;
    const userEl = document.querySelector('#userData');
    userEl.querySelector('div#logout > pre').innerText = e.data;
    e.data ? userEl.setAttribute('active', 'loggedIn') : userEl.removeAttribute('active');
    if (!e.data)
      location = location.href;
  });

//   for (let link of document.querySelectorAll("a-popup"))
//     link.addEventListener('click', openRequestedSinglePopup);
//
//   function popupParameters() {
//     const width = Math.min(600, window.screen.width);
//     const height = Math.min(600, window.screen.height);
//     const left = window.screen.width / 2 - width / 2;
//     const top = window.screen.height / 2 - height / 2;
//     return "resizable,scrollbars,status,opener," +
//       Object.entries({width, height, left, top}).map(kv => kv.join('=')).join(',');
//   }
//
//   function openRequestedSinglePopup(event) {
//     event.preventDefault();
//     let url = event.currentTarget.href;
//     if (document.querySelector('input').checked)
//       url += '?remember-me';
//     if (!loginWindow || loginWindow.closed) {
//       loginWindow = window.open(url, "_blank", popupParameters());
// //      loginWindow.onunload = unloadOnMe;//alternative approach to using postMessage. This will require an extra roundtrip to the server
//     } else if (loginWindowUrl !== url)
//       loginWindow.location = url;
//     loginWindowUrl = url;
//     loginWindow.focus();
//   }
</script>
